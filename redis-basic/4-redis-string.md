# 1.redis string 字符串

redis 自定义了一个特殊结构SDS（Simple Dynamic String）, 一个可以修改内部结构，类似Java的 ArrayList。

1.1 SDS 动态字符串

```text
struct sdshdr{
  int len; // 记录buf数组中已使用字符的数量，等于 SDS 保存字符串的长度
  int free; // 记录 buf 数组中未使用的字符数量
  char buf[]; // 字符数组，用于保存字符串
}
```

1.2 分配冗余空间

string 采用了预先分配冗余空间的方式来减少内存的频繁分配。在一定程度上提升了 Redis string 存储的效率，比如当字符串长度变大时，无需再重新申请内存空间。

1.3 自动扩容

当字符串所占空间小于 1MB 时，Redis 对字符串存储空间的扩容是以成倍的方式增加的；而当所占空间超过 1MB 时，每次扩容只增加 1MB。Redis 字符串允许的最大值字节数是 512 MB。

------

# 2.redis bitmap 位图

位图（bitmap）同样属于 string 数据类型。Redis 中一个字符串类型的值最多能存储 512 MB 的内容，每个字符串由多个字节组成，每个字节又由 8 个 Bit 位组成。位图结构正是使用“位”来实现存储的，它通过将比特位设置为
0 或 1来达到数据存取的目的，这大大增加了 value 存储数量，它存储上限为2^32 。

位图本质上就是一个普通的字节串，也就是 bytes 数组。您可以使用getbit/setbit命令来处理这个 byte 数组。

2.1 位图bitmap应用场景

- 用户签到次数、或者登录次数等

2.2 位图bitmap应用原理

- 若使用位图存储，用户签到就存 1，否则存 0。最后会生成 11010101... 这样的存储结果，其中每天的记录只占一位，一年就是 365 位，约为 46 个字节。
- 数组是自动扩展的，如果设置了某个偏移位置超出了现有的内容范围，位数组就会自动扩充。

```text
// 1,2,4 指的是位偏置数，初始二进制位都是0
setbit key 1 1 
setbit key 2 1
setbit key 4 1
get key // 获取到 "h"
setbit key 9 1
setbit key 10 1
setbit key 13 1
setbit key 15 1
get key // 获取到 "he"，说明key自定进行了扩容
bitcount key [start end] // 统计指定位区间的值为1的个数总数
```

------

# 3.数值操作命令

string 类型提供了一些专门操作数值的命令，比如 INCRBY（自增）、DECRBR（自减）、INCR（加1） 和 DECR（减1）
等命令。数值操作，同样有特定的应用场景，比如常见的点赞、取消点赞、关注、取消关注等，这类和计数相关的场景都可以使用数值操作来实现。

> 此时 key 对应的 value 值是必须是一个整数，或浮点数，使用命令对这个数值进行自增或自减操作。当然，这个数值也不能无限的增大或减小， Redis 规定的数值范围是 -9223372036854775808 至 9223372036854775807，如果超过了这个数值范围，Redis 就会报错。

