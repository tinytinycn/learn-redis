# redis 分布式锁

## 分布式锁

在分布式系统中，当不同进程或线程一起访问共享资源时，会造成资源争抢，如果不加以控制的话，就会引发程序错乱。此时使用分布式锁能够非常有效的解决这个问题，它采用了一种互斥机制来防止线程或进程间相互干扰，从而保证了数据的一致性。

## redis 实现分布式锁的特点

- Redis 是缓存型数据库，拥有很高的性能，因此加锁和释放锁开销较小，并且能够很轻易地实现分布式锁;
- 加锁和解锁必须是由同一个线程来设置;
- 互斥性, 在任意时刻，只有一个线程能够持有锁;
- 锁的超时时间，一个线程在持锁期间挂掉了而没主动释放锁，此时通过超时时间来保证该线程在超时后可以释放锁，这样其他线程才可以继续获取锁;

## redis 实现方案
- 命令 `setnx key val` `expire key timeout`
- 改进版命令 `set key val [expiration EX seconds|PX millisenconds] [NX|XX]`